(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[423],{4533:function(e,t,a){Promise.resolve().then(a.bind(a,714))},9763:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(2265),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n=(e,t)=>{let a=(0,s.forwardRef)((a,n)=>{let{color:l="currentColor",size:c=24,strokeWidth:d=2,absoluteStrokeWidth:o,className:h="",children:u,...x}=a;return(0,s.createElement)("svg",{ref:n,...i,width:c,height:c,stroke:l,strokeWidth:o?24*Number(d)/Number(c):d,className:["lucide","lucide-".concat(r(e)),h].join(" "),...x},[...t.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(u)?u:[u]])});return a.displayName="".concat(e),a}},6858:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},9688:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]])},2489:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},714:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(7437),i=a(2265),r=a(9688),n=a(2489),l=a(9763);let c=(0,l.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),d=(0,l.Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),o=(0,l.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),h=(0,l.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var u=a(6858),x=a(2946),m=a(9376);function p(){let e=(0,m.useRouter)(),[t]=(0,i.useState)(()=>new x.D),[a,l]=(0,i.useState)("OPEN"),[p,f]=(0,i.useState)(!1),[g,b]=(0,i.useState)(0),[y,v]=(0,i.useState)(""),[k,w]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{b(await t.getCashInHand()),l(await t.getShiftState())})()},[t]);let N=async()=>{let a=parseFloat(y)||0;await t.endShift(a),e.push("/driver/login")},j=(parseFloat(y)||0)-g;return(0,s.jsxs)("div",{className:"flex flex-col gap-8 px-6",children:[(0,s.jsx)("header",{className:"flex justify-between items-center",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-black text-white italic tracking-tighter uppercase mb-1",children:"Shift Control"}),(0,s.jsx)("p",{className:"text-xs font-black text-nile-silver/30 uppercase tracking-[0.2em]",children:"Operational Handshake"})]})}),(0,s.jsx)("div",{className:"p-8 rounded-[2.5rem] bg-white/[0.02] border border-white/5 flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-3xl flex items-center justify-center transition-all ".concat("OPEN"===a?"bg-emerald-500 text-nile-dark":"bg-red-500/20 text-red-500"),children:(0,s.jsx)(r.Z,{size:32})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-xl font-black text-white italic uppercase tracking-tight",children:["Shift is ",a]}),(0,s.jsx)("div",{className:"text-[10px] font-bold text-nile-silver/20 uppercase tracking-[0.2em]",children:"Started: Dec 24, 09:00 AM"})]})]})}),"OPEN"===a?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("button",{onClick:()=>f(!0),className:"w-full h-24 rounded-[2rem] bg-red-500 active:bg-red-600 text-nile-dark active:scale-[0.98] transition-all flex items-center justify-between px-8",children:[(0,s.jsxs)("div",{className:"flex flex-col items-start translate-z-0",children:[(0,s.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest opacity-40 mb-1",children:"End Duty"}),(0,s.jsx)("span",{className:"text-2xl font-black italic tracking-tight uppercase",children:"Close Shift"})]}),(0,s.jsx)(n.Z,{size:32})]}),(0,s.jsx)("p",{className:"text-center text-[10px] font-bold text-nile-silver/20 uppercase tracking-widest",children:"Closing the shift requires final cash reconciliation."})]}):(0,s.jsxs)("button",{onClick:()=>e.push("/driver/login"),className:"w-full h-24 rounded-[2rem] bg-emerald-500 text-nile-dark font-black text-2xl italic flex items-center justify-center gap-4",children:["Open New Shift ",(0,s.jsx)(c,{size:32})]}),p&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-[#050505] flex flex-col p-6 animate-in slide-in-from-bottom duration-300",children:(0,s.jsxs)("div",{className:"flex-1 flex flex-col pt-12",children:[(0,s.jsxs)("header",{className:"mb-12 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-3xl bg-white/5 flex items-center justify-center text-white mx-auto mb-6",children:(0,s.jsx)(d,{size:32})}),(0,s.jsx)("h2",{className:"text-3xl font-black text-white italic uppercase mb-2",children:"Reconciliation"}),(0,s.jsx)("p",{className:"text-xs font-black text-nile-silver/30 uppercase tracking-[0.2em]",children:"Verify Physical Cash Balance"})]}),(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"p-8 rounded-4xl bg-white/5 border border-white/5 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-bold text-nile-silver",children:"Digital Balance"}),(0,s.jsxs)("span",{className:"text-xl font-black text-white italic",children:[g.toFixed(2)," EGP"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-nile-silver/40 px-4",children:"Physical Count"}),(0,s.jsx)("input",{type:"number",value:y,onChange:e=>v(e.target.value),placeholder:"0.00",className:"w-full h-24 rounded-[2rem] bg-white/[0.03] border-2 border-white/5 focus:border-emerald-500/50 outline-none text-center text-4xl font-black italic text-white transition-all"})]}),""!==y&&Math.abs(j)>.01&&(0,s.jsxs)("div",{className:"p-8 rounded-[2rem] bg-red-500/10 border border-red-500/20 animate-in zoom-in-95 duration-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-red-500",children:[(0,s.jsx)(o,{size:20}),(0,s.jsx)("span",{className:"text-sm font-black uppercase tracking-widest",children:"Mismatch Detected"})]}),(0,s.jsxs)("span",{className:"text-2xl font-black text-red-500 italic",children:[j>0?"+":"",j.toFixed(2)]})]}),(0,s.jsx)("textarea",{value:k,onChange:e=>w(e.target.value),placeholder:"Reason for discrepancy...",className:"w-full h-24 rounded-2xl bg-black/40 border border-white/5 p-4 text-xs font-medium text-white placeholder:text-nile-silver/20 outline-none focus:border-red-500/40"})]}),(0,s.jsxs)("div",{className:"p-6 rounded-3xl bg-blue-500/5 border border-blue-500/10 flex gap-4",children:[(0,s.jsx)(h,{size:20,className:"text-blue-500 shrink-0"}),(0,s.jsx)("p",{className:"text-[10px] font-medium text-blue-500/70 leading-relaxed italic",children:"By submitting, you are cryptographically signing this end-of-shift report to the NileLink Ledger."})]})]}),(0,s.jsxs)("div",{className:"mt-auto flex gap-4 pt-12",children:[(0,s.jsx)("button",{onClick:()=>f(!1),className:"flex-1 h-20 rounded-3xl bg-white/5 text-white font-bold uppercase text-xs",children:"Cancel"}),(0,s.jsxs)("button",{onClick:N,disabled:!y,className:"flex-[2] h-20 rounded-3xl bg-red-500 text-nile-dark font-black uppercase text-sm tracking-widest flex items-center justify-center gap-3 disabled:opacity-50",children:["Submit & Close ",(0,s.jsx)(u.Z,{size:20})]})]})]})})]})}},2946:function(e,t,a){"use strict";a.d(t,{D:function(){return i}});class s{init(){console.log("[MobileLedger] Initializing Local Chain..."),localStorage.getItem(this.dbName)||localStorage.setItem(this.dbName,JSON.stringify([]))}async recordEvent(e,t){let a=await this.getAllEvents(),s=a[a.length-1],i={id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2),type:e,timestamp:Date.now(),actorId:"driver-current",deviceId:"device-mobile-01",hash:"pending-hash",prevHash:s?s.hash:null,payload:t,synced:!1};return i.hash="".concat(i.id,":").concat(Date.now()),a.push(i),this.saveEvents(a),console.log("[MobileLedger] \uD83D\uDD17 Block Mined: ".concat(e),i),i}async getEvents(){return this.getAllEvents()}async getCashBalance(){let e=await this.getAllEvents(),t=0;for(let a of e)"CASH_COLLECTED"===a.type?t+=a.payload.amount||0:"CASH_DEPOSITED"===a.type&&(t-=a.payload.amount||0);return t}async getShiftStatus(){let e=(await this.getAllEvents()).reverse().find(e=>"SHIFT_OPEN"===e.type||"SHIFT_CLOSE"===e.type);return e&&"SHIFT_OPEN"===e.type?"OPEN":"CLOSED"}getAllEvents(){let e=localStorage.getItem(this.dbName);return e?JSON.parse(e):[]}saveEvents(e){localStorage.setItem(this.dbName,JSON.stringify(e))}constructor(){this.dbName="nilelink_delivery_ledger",this.init()}}class i{async startShift(e){return"1234"===e&&(await this.ledger.recordEvent("SHIFT_OPEN",{method:"PIN"}),!0)}async endShift(e){let t=await this.ledger.getCashBalance();return await this.ledger.recordEvent("SHIFT_CLOSE",{confirmedBalance:e,sysBalance:t,variance:e-t}),!0}async acceptOrder(e){await this.ledger.recordEvent("TASK_ACCEPTED",{orderId:e})}async pickupOrder(e){await this.ledger.recordEvent("TASK_PICKED_UP",{orderId:e,location:"mock-lat-long"})}async completeDelivery(e,t,a){await this.ledger.recordEvent("TASK_COMPLETED",{orderId:e,proof:t}),a>0&&await this.ledger.recordEvent("CASH_COLLECTED",{orderId:e,amount:a})}async failDelivery(e,t){await this.ledger.recordEvent("TASK_FAILED",{orderId:e,reason:t})}async getCashInHand(){return this.ledger.getCashBalance()}async getShiftState(){return this.ledger.getShiftStatus()}constructor(){this.ledger=new s}}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4533)}),_N_E=e.O()}]);